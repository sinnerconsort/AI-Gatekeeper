<div id="gatekeeper_settings">
    <div class="inline-drawer">
        <div class="inline-drawer-toggle inline-drawer-header">
            <b><i class="fa-solid fa-masks-theater"></i> AI Gatekeeper</b>
            <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
        </div>
        <div class="inline-drawer-content">
            <!-- Enable Toggle -->
            <div class="gatekeeper-setting-row">
                <label class="checkbox_label">
                    <input type="checkbox" id="gatekeeper-enabled" />
                    <span>Enable Gatekeeper</span>
                </label>
            </div>
            
            <hr />
            
            <!-- API Configuration -->
            <h4><i class="fa-solid fa-plug"></i> API Configuration</h4>
            
            <!-- Connection Profile Mode -->
            <div class="gatekeeper-setting-row">
                <label class="checkbox_label">
                    <input type="checkbox" id="gatekeeper-use-profile" checked />
                    <span>Use Connection Profile</span>
                </label>
                <small class="notes">Use an existing SillyTavern connection profile (recommended)</small>
            </div>
            
            <div id="gatekeeper-profile-section">
                <div class="gatekeeper-setting-row">
                    <label>Connection Profile *</label>
                    <div style="display: flex; gap: 5px;">
                        <select id="gatekeeper-connection-profile" class="text_pole" style="flex: 1;">
                            <option value="">-- Select Profile --</option>
                        </select>
                        <button id="gatekeeper-refresh-profiles" class="menu_button" title="Refresh Profiles">
                            <i class="fa-solid fa-refresh"></i>
                        </button>
                    </div>
                    <small class="notes">Select a profile from Connection Manager</small>
                </div>
                <div class="gatekeeper-setting-row">
                    <label>Or enter profile name manually:</label>
                    <input type="text" id="gatekeeper-profile-manual" class="text_pole" placeholder="Type exact profile name..." />
                    <small class="notes">Use if profile detection doesn't work. Type the exact profile name as shown in ST's Connection Manager.</small>
                </div>
            </div>
            
            <!-- Direct API Mode (hidden by default) -->
            <div id="gatekeeper-direct-api-section" style="display: none;">
                <div class="gatekeeper-setting-row">
                    <label>AI Provider *</label>
                    <select id="gatekeeper-provider" class="text_pole">
                        <option value="openai">OpenAI</option>
                        <option value="anthropic">Anthropic</option>
                        <option value="openrouter">OpenRouter</option>
                        <option value="custom">Custom / Local (OpenAI Compatible)</option>
                    </select>
                </div>
                
                <div class="gatekeeper-setting-row">
                    <label>AI Model *</label>
                    <select id="gatekeeper-model" class="text_pole">
                        <option value="">-- Select Model --</option>
                    </select>
                    <input type="text" id="gatekeeper-model-custom" class="text_pole" placeholder="Or type model name..." style="margin-top: 5px;" />
                </div>
                
                <div class="gatekeeper-setting-row">
                    <label>API URL (Optional)</label>
                    <input type="text" id="gatekeeper-api-url" class="text_pole" placeholder="https://api.openai.com/v1" />
                    <small class="notes">Leave blank for default. Required for Custom provider.</small>
                </div>
                
                <div class="gatekeeper-setting-row">
                    <label>API Key *</label>
                    <div style="display: flex; gap: 5px;">
                        <input type="password" id="gatekeeper-api-key" class="text_pole" placeholder="sk-..." style="flex: 1;" />
                        <button id="gatekeeper-test-connection" class="menu_button" title="Test Connection">
                            <i class="fa-solid fa-vial"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <hr />
            
            <!-- World Settings -->
            <h4><i class="fa-solid fa-globe"></i> World Settings</h4>
            
            <div class="gatekeeper-setting-row">
                <label>Setting</label>
                <select id="gatekeeper-setting" class="text_pole">
                    <option value="realistic">Realistic</option>
                    <option value="low_fantasy">Low Fantasy</option>
                    <option value="high_fantasy">High Fantasy</option>
                    <option value="sci_fi">Sci-Fi</option>
                    <option value="blended">Blended</option>
                </select>
            </div>
            
            <div class="gatekeeper-setting-row">
                <label>Tone</label>
                <select id="gatekeeper-tone" class="text_pole">
                    <option value="cozy">Cozy</option>
                    <option value="drama">Drama</option>
                    <option value="thriller">Thriller</option>
                    <option value="horror">Horror</option>
                    <option value="dark">Dark</option>
                    <option value="chaotic">Chaotic</option>
                </select>
            </div>
            
            <div class="gatekeeper-setting-row">
                <label>Pacing</label>
                <select id="gatekeeper-pacing" class="text_pole">
                    <option value="slow_burn">Slow Burn</option>
                    <option value="balanced">Balanced</option>
                    <option value="escalating">Escalating</option>
                    <option value="volatile">Volatile</option>
                </select>
            </div>
            
            <div class="gatekeeper-setting-row">
                <label>Chaos Factor: <span id="gatekeeper-chaos-value">2</span></label>
                <input type="range" id="gatekeeper-chaos" min="1" max="5" value="2" />
                <small class="notes">Higher = more unpredictable interventions</small>
            </div>
            
            <hr />
            
            <!-- User Seeds -->
            <h4><i class="fa-solid fa-seedling"></i> Story Seeds</h4>
            <small class="notes" style="display: block; margin-bottom: 10px;">
                Plant seeds for the Gatekeeper to weave into the story naturally.
            </small>
            
            <div class="gatekeeper-seed-input">
                <textarea id="gatekeeper-new-seed" class="text_pole" placeholder="Plant a seed... (e.g., 'His past catches up with him')" rows="2"></textarea>
                <button id="gatekeeper-add-seed" class="menu_button">
                    <i class="fa-solid fa-seedling"></i> Plant Seed
                </button>
            </div>
            
            <div id="gatekeeper-seeds-list" class="gatekeeper-seeds-list">
                <!-- Seeds will be populated here -->
            </div>
            
            <hr />
            
            <!-- Status -->
            <h4><i class="fa-solid fa-chart-line"></i> Gatekeeper Status</h4>
            <div id="gatekeeper-status" class="gatekeeper-status">
                <div>Threads active: <span id="gatekeeper-threads-count">0</span></div>
                <div>Seeds planted: <span id="gatekeeper-planted-count">0</span></div>
                <div>Last action: <span id="gatekeeper-last-action">None</span></div>
            </div>
        </div>
    </div>
</div>
